name: cassandra
version: 3.8-SNAPSHOT
summary: Cassandra distributed database
description: The Apache Cassandra database
confinement: strict
apps:
    cassandra:
        command: wrapper-cassandra
        daemon: simple
        # mount-observe is needed for checking available space in the data
        # directories (java.io.File.getTotalSpace). It must be manually
        # connected with:
        # `snap connect cassandra:mount-observe ubuntu-core:mount-observe`
        plugs: [network, network-bind, mount-observe]
        # The setpriority syscall is also needed, but currently unavailable:
        # https://bugs.launchpad.net/snappy/+bug/1577520
    nodetool:
        command: wrapper-nodetool
        plugs: [network]

    # Helpers. These will go away when snapd provides a config interface.
    config-get:
        command: config-get
    config-set:
        command: config-set
    env-get:
        command: env-get
parts:
    cassandra:
        plugin: cassandra
        source: git://github.com/apache/cassandra
        stage-packages:
            - mawk
            - grep
            # For /usr/bin/free
            - procps
        organize:
            conf: etc/cassandra
            bin/cassandra: usr/sbin/cassandra
            lib: usr/share/cassandra/lib
            usr/bin/mawk: usr/bin/awk
        snap:
            - bin/nodetool
            - etc/cassandra
            - usr/sbin/cassandra
            - usr/share/cassandra/lib/*.jar
            - usr/lib/jvm
            # These three needed by cassandra-env.sh
            - usr/bin/awk
            - bin/grep
            - usr/bin/free
    glue:
        plugin: copy
        files:
            wrapper-cassandra: bin/wrapper-cassandra
            wrapper-nodetool: bin/wrapper-nodetool
            # Helpers. These will go away when snapd provides a config
            # interface.
            config-get: bin/config-get
            config-set: bin/config-set
            env-get: bin/env-get
            common: bin/common

# vim: set ai et sts=4 tabstop=4 sw=4:
